--------------------OCA---------------------------
select e.id, e.event_date, e.tracking_description, e.tracking_status, e.tracking_number, e.date_created, e.last_updated, e.application_id, e.count_repeat
from shp_w01.shipment s, shp_w01.tracking_events e
where s.tracking_number in (
'3867500000000538203',
'3867500000000553519',
'3867500000000474881'
) and s.tracking_number = e.tracking_number
order by e.tracking_number, e.event_date desc;

select *
from shp_w01.shipment
where tracking_number = '3867500000000538203';

select *
from shp_w01.tracking_status
--where description like '%anul%' or description like '%Anul%'
where status_id = '3' or status_id = '52'
and service_id between 61 and 64
order by service_id;
--where status_id = '52';
--------------------------------------------------

--------------------ND----------------------------
select * from shp_w01.tracking_status where status_id like 'BDE10%' order by status_id, service_id;
select * from shp_w01.tracking_status where status_id like 'ND%' order by status_id, service_id;
select * from shp_w01.shipping_service where id = 21;

select id, status, substatus, order_id, tracking_number, service_id, date_created, date_handling, date_ready_to_ship, date_delivered, date_not_delivered, date_cancelled, date_first_visit, last_updated
from shp_w01.shipment
--where tracking_number in ('SW910172340BR','SW910276027BR','SW910378763BR','SW910380489BR','SW910397538BR','SW910397793BR','SW910406481BR','SW910409103BR','SW910470105BR','SW910477942BR','SW910532207BR','SW910597830BR','SW910699034BR','SW910751057BR','SW910751879BR','SW910752300BR','SW910759926BR','SW910760907BR','SW910761607BR','SW910765538BR','SW910767088BR','SW910769659BR','SW910775040BR','SW910775481BR','SW910777023BR','SW910779642BR','SW910831356BR','SW910873775BR','SW910875595BR','SW910876984BR','SW910877959BR','SW910879138BR','SW910879795BR','SW910882525BR','SW910883248BR','SW910884950BR','SW910886774BR','SW910887488BR','SW910887721BR','SW910888015BR','SW910888982BR','SW910890080BR','SW910890694BR','SW910891329BR','SW910892531BR','SW910895997BR','SW910896445BR','SW910897216BR','SW910899367BR','SW910899574BR','SW910899821BR','SW910904230BR','SW910904495BR','SW910904583BR','SW910906054BR','SW910906641BR','SW910909577BR','SW910911125BR','SW910912386BR','SW910913280BR','SW910913347BR','SW910913639BR','SW910914501BR','SW910916312BR','SW910921388BR','SW910922304BR','SW910923812BR','SW910924954BR','SW910926399BR','SW910928868BR','SW910929727BR','SW910930155BR','SW910930376BR','SW910932054BR','SW910932496BR','SW910932757BR','SW910936365BR','SW910936453BR','SW910937224BR','SW910942048BR','SW910943794BR','SW910943984BR','SW910947544BR','SW910948329BR','SW910949430BR','SW910950279BR','SW910950716BR','SW910952663BR','SW910953261BR','SW910955656BR','SW910961435BR','SW910966101BR','SW910967305BR','SW910968178BR','SW910970724BR','SW910972606BR','SW910972929BR','SW910973147BR','SW910974125BR','SW910974893BR','SW910975412BR','SW910975721BR','SW910979286BR','SW910979581BR','SW910980324BR','SW910981038BR','SW910982648BR','SW910983881BR','SW910987866BR','SW910988359BR','SW910988521BR','SW910989898BR','SW910990658BR','SW910990729BR','SW910992132BR','SW910992319BR','SW910993053BR','SW910993265BR','SW910993760BR','SW910994487BR','SW910995244BR','SW910995425BR','SW910995505BR','SW910996151BR','SW910998775BR','SW911003585BR','SW911003784BR','SW911004657BR','SW911004935BR','SW911005595BR','SW911006009BR','SW911007525BR','SW911010272BR','SW911010961BR','SW911011030BR','SW911015717BR','SW911017837BR','SW911018700BR','SW911028857BR','SW911032454BR','SW911036195BR','SW911039758BR','SW911039996BR','SW911041425BR','SW911042111BR','SW911099164BR','SW911100106BR','SW911100260BR','SW911100525BR','SW911100826BR','SW911103495BR','SW911103751BR','SW911103938BR','SW911104434BR','SW911104607BR','SW911105430BR','SW911105545BR','SW911105559BR','SW911105695BR','SW911107625BR','SW911107682BR','SW911110491BR','SW911111072BR','SW911111126BR','SW911112492BR','SW911113351BR','SW911113878BR','SW911113904BR','SW911114842BR','SW911114935BR','SW911115729BR','SW911117146BR','SW911119076BR','SW911119592BR','SW911119748BR','SW911122384BR','SW911123098BR','SW911123169BR','SW911123711BR','SW911124535BR','SW911177025BR','SW911179123BR','SW911180815BR','SW911181073BR','SW911181674BR','SW911184110BR','SW911185058BR','SW911187561BR','SW911188434BR','SW911193346BR','SW911193712BR','SW911193814BR','SW911196095BR','SW911196838BR','SW911197626BR','SW911199159BR','SW911201793BR','SW911204667BR','SW911206314BR','SW911207575BR','SW911208448BR','SW911216515BR','SW911216532BR','SW911219423BR','SW911227875BR','SW911228853BR','SW911231937BR','SW911240050BR','SW911240752BR','SW911242679BR','SW911243793BR','SW911563660BR','SW911564665BR','SW911568548BR','SW911592710BR','SW911605435BR','SW911610245BR','SW911610815BR','SW911614389BR','SW911616124BR','SW911616495BR','SW911616570BR','SW911617884BR','SW911640548BR','SW911640579BR','SW911640619BR','SW911642098BR','SW911643836BR','SW911644125BR','SW911646713BR','SW911646727BR','SW911647183BR','SW911648966BR','SW911649096BR','SW911649595BR','SW911651727BR','SW911651863BR','SW911651996BR','SW911652081BR','SW911652183BR','SW911652492BR','SW911653250BR','SW911656070BR','SW911656667BR','SW911656675BR','SW911657509BR','SW911658053BR','SW911660587BR','SW911661707BR','SW911661809BR','SW911663932BR','SW911665814BR','SW911665981BR','SW911667934BR','SW911668679BR','SW911669609BR','SW911669612BR','SW911670054BR','SW911671094BR','SW911671253BR','SW911671616BR','SW911671752BR','SW911672381BR','SW911672395BR','SW911672965BR','SW911673356BR','SW911674538BR','SW911675198BR','SW911676030BR','SW911676321BR','SW911677035BR','SW911677070BR','SW911677503BR','SW911677931BR','SW911679637BR','SW911680224BR','SW911681834BR','SW911682980BR','SW911683849BR','SW911685867BR','SW911686244BR','SW911686315BR','SW911688038BR','SW911688302BR','SW911688452BR','SW911689550BR','SW911691071BR','SW911701410BR','SW911706156BR','SW911707678BR','SW911717882BR','SW911718432BR','SW911718809BR','SW911720303BR','SW911772645BR','SW911773076BR','SW911773116BR','SW911774425BR','SW911774947BR','SW911775987BR','SW911778396BR','SW911778555BR','SW911778776BR','SW911784808BR','SW911786707BR','SW911786772BR','SW911788314BR','SW911790162BR','SW911790295BR','SW911790834BR','SW911791145BR','SW911791993BR','SW911792764BR','SW911793570BR','SW911795519BR','SW911799507BR','SW911804034BR','SW911804900BR','SW911805539BR','SW911809986BR','SW911811724BR','SW911823152BR','SW911824215BR','SW911825326BR','SW911825649BR','SW911826159BR','SW911826865BR','SW911831732BR','SW911831777BR','SW911831998BR','SW911833115BR','SW911836978BR','SW911839529BR','SW911839872BR','SW911841575BR','SW911843792BR','SW911845060BR','SW911845878BR','SW911846198BR','SW911846975BR','SW911851374BR','SW911851604BR','SW911852485BR','SW911852922BR','SW911854248BR','SW911855760BR','SW911856178BR','SW911856629BR','SW911860209BR','SW911864024BR','SW911864112BR','SW911867269BR','SW911869168BR','SW911870373BR','SW911875923BR','SW911878774BR','SW911882592BR','SW911893003BR','SW911893895BR','SW911908096BR','SW911910395BR','SW911984398BR','SW912059745BR','SW912060522BR')
--where tracking_number in ('3867500000000474881')
where tracking_number in 
('SW886111396BR',
'PD444753521BR',
'PD466377822BR')
order by status, substatus, date_created;


-------------------- check shipped with delivered events ---------------------
select *
from shp_w01.shipment s
where s.date_created > sysdate - 30
and s.last_updated > sysdate - 30
and s.status in ('ready_to_ship','shipped')
and s.shipping_mode = 'me2'
and s.service_id in (61,62,63,64)
and s.site_id = 'MLA'
and exists (
  select 1 from shp_w01.tracking_events e where s.tracking_number = e.tracking_number and e.tracking_status in ('85') and /*(e.tracking_description like '%Anul%' or e.tracking_description like '%anul%') and*/ e.date_created > sysdate - 30
);


select *
from shp_w01.tracking_events
where tracking_number in ('3867500000000985977','3867500000000985029','3867500000000978719')
order by tracking_number, event_date desc;

select *
from shp_w01.shipment
where tracking_Number = '3867500000000978719';


select *
from shp_w01.tracking_events te
where te.tracking_number in (
  select s.tracking_number
  from shp_w01.shipment s
  where s.date_created > sysdate - 7
  and s.last_updated > sysdate - 7
  and s.status in ('ready_to_ship','shipped')
  and s.shipping_mode = 'me2'
  and s.service_id in (61,62,63,64)
  and s.site_id = 'MLA'
  and exists (select 1 from shp_w01.tracking_events e where s.tracking_number = e.tracking_number and e.tracking_status in ('52','85') and e.date_created > sysdate - 7)
)
and te.application_id ;
-----------------------------------------------------------------------------------

select e.tracking_number, e.event_date, e.tracking_description, e.tracking_status, e.count_repeat, e.application_id, e.date_created, e.last_updated, s.status, s.substatus, s.date_shipped, s.speed, s.date_created date_created_ship, s.last_updated last_updated_ship
from shp_w01.tracking_events e, shp_w01.shipment s
where s.tracking_number in 
('SW886111396BR',
'PD444753521BR',
'PD466377822BR')
and e.tracking_number = s.tracking_number
order by tracking_number, event_date desc;

select * from shp_w01.shipment where id = 21128549223;

select *
from shp_w01.tracking_status
where status_id = 'ND03';


--TODO revisar que no haya shipped con eventos de Correios mapeados a delivered. Esta guardado ese query?
--------------------------------------------------

--------------------HT----------------------------
select avg(DATE_SHIPPED - DATE_READY_TO_SHIP) from  shp_w01.shipment
where sender_id = 45145551
and date_shipped  > sysdate -15
and status in ('shipped', 'delivered');

select  max (DATE_SHIPPED - DATE_READY_TO_SHIP) from  shp_w01.shipment
where sender_id = 45145551
and date_shipped  > sysdate -30
and status in ('shipped', 'delivered');

--------------------------------------------------



select *
from shp_w01.shipment
where order_id in ('827478857','829979891','829979000','829980575');

select *
from shp_w01.tracking_events
where tracking_number in (select tracking_number from shp_w01.shipment where order_id in ('827478857','829979891','829979000','829980575'));

select *
from shp_w01.tracking_number
where shipping_id in (select id from shp_w01.shipment where order_id in ('827478857','829979891','829979000','829980575'));


